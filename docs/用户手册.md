# 用户手册

3180105871，孙嘉锴

## 目录

* 项目简介
* 功能介绍
* 操作指南

## 项目简介

* 项目名称：物联网应用网站ChaoS_JK

* 开发团队：[SJoJoK](https://github.com/SJoJoK)

* 项目主页：[SJoJoK/ZJU_BS_IOT](https://github.com/SJoJoK/ZJU_BS_IOT)

* 项目概述：物联网应用网站是浙江大学2020-2021学年秋冬学期B/S体系软件设计的课程作业，主要内容是搭建一个MQTT协议服务器以接收指定物联网终端发送的数据，除基础的用户注册、登录功能外，为用户提供创建或修改设备信息、统计与查询设备数据、记录与区分设备位置等功能。
* 面向用户：验收团队，以及需要查看、统计与编辑物联网终端信息的人群

## 功能介绍

*注：如需在本地部署网站，请移步[开发文档](./开发文档.md)*

### 功能模块

#### 游客

* 用户登录模块
* 用户注册模块

#### 用户

* 统计展示模块
* 设备轨迹模块
* 设备管理模块

### 具体功能

- 使用用户名、密码登陆网站
- 使用用户名、密码、邮箱，进行验证与注册
- 查看设备最新发布消息
- 查看设备历史轨迹，区分正常信息与告警信息
- 查看并编辑、新建、删除设备
- 通过图表形式查看设备、数据的统计情况

## 操作指南

### 用户注册与登录

#### 登录

访问[本地部署端口](http://localhost:3000)时，若无token，则会进入登陆页面

![登陆界面]( assets/登陆界面.png)

登陆页面会对表单信息进行初步的验证

![登陆验证]( assets/登陆验证.png)

若用户名或密码错误，则会弹出错误信息

![用户密码验证](assets/用户密码验证.png)

若用户名或密码正确，则会弹出“登陆成功”，并进入主页

登陆成功后，会获得有效期3天的token

#### 注册

在登录界面点击“现在注册”即可进入注册界面

![注册界面](assets/注册界面.png)

注册页面会对表单信息进行初步的验证

![注册页面验证](assets/注册页面验证.png)

当邮箱格式正确时，即可获得验证码

![邮箱验证](assets/邮箱验证.png)

验证码会通过csjk@zju.edu.cn发送至注册邮箱

![邮箱验证码](assets/邮箱验证码.jpg)

在提交注册表单后，会进行验证码验证

![验证码验证](assets/验证码验证.png)

与用户名邮箱唯一性验证

![用户名邮箱唯一](assets/用户名邮箱唯一.png)

注册成功后，会弹出提示

![注册成功](assets/注册成功.png)

接着就可点击“马上登录!”返回登陆界面进行登录

### 设备管理与统计

#### 首页

用户成功登陆后，会跳转到首页

访问[本地部署端口](http://localhost:3000)时，若有token，亦会跳转至首页

因为是新用户，所以首页暂无统计信息

![空主页](assets/空主页.png)

首页展示的信息有（下面是用test账户的统计信息）：

* 总设备数、总数据包、总数据量

  ![总设备数](assets/总设备数.png)

* 七天内每日新增设备数（点击“设备”图标）

  ![新增设备数](assets/新增设备数.png)

* 七天内每日新增数据包（点击“礼包”图标）

  ![新增数据包](assets/新增数据包.png)

* 七天内每日新增数据量（点击“数据量”图标）

  ![新增数据量](assets/新增数据量.png)

#### 设备管理页

可以通过导航栏进入设备管理页

因为是新用户，所以暂无设备

![空设备管理](assets/空设备管理.png)

设备管理页功能有

* 显示设备信息（使用test账户）

  ![设备管理-test](assets/设备管理-test.png)

  表格项定义：

  * 序号

    设备id，每个用户设备的唯一辨识码

  * 设备名

    设备名，可重复

  * 上传量

    设备上传数据总量

  * 状态

    设备在线与否

  * 最近通信时间

    设备最近一次发布数据的时间

  * 最近通信地点

    设备最近一次发布数据的地点

  * 最近通信地点

    设备最近一次发布MQTT包payload部分的data字段

    **注**：设备发布MQTT包的payload部分应是JSON格式，如下

    ![Payload](assets/Payload.png)

    payload部分数据定义：

    * warning

      类型：Boolean，代表告警与否

    * location

      类型：Array，代表包发布的地点，第一项为经度，第二项为维度

    * data

      类型：String，代表发布的数据

* 新增设备

  ![添加设备](assets/添加设备.png)

  新增设备后，需要使用IoT终端连接[本地](http://localhost)的5871（或您在部署阶段设置的）端口，用户名和密码为ChaoS_JK网站的用户名和密码，ClientID为'[用户名]-[序号]'，如Ambrum的序号为0的设备，ClientID为'Ambrum-0'，用户名的唯一性与每一位用户设备序号的唯一性保证了MQTT服务器可以唯一识别IoT终端
  
  **注意！**若未先在设备管理页添加设备，即使设备与服务器建立了链接，服务器也不会将该设备注册到用户名下

* 删除设备（使用test账户）

  我们删除了5、6、7设备

  ![删除设备](assets/删除设备.png)

  如果删除设备后再新增设备，设备id会自动取为当前未被使用的id的最小值

  ![新增空缺设备](assets/新增空缺设备.png)

  如图，我们增加了设备a，其id为5

* 编辑设备（使用test账户）

  ![编辑设备](assets/编辑设备.png)

  可以修改设备的设备名与在线状态

  ![NEWDIVICE](assets/NEWDIVICE.png)

  如图，原先的a被改名为NEWDEVICE

* 筛选设备（使用test账户）

  ![单次筛选](assets/单次筛选.png)

  ![多项筛选](assets/多项筛选.png)

#### 地图显示页

因为是新用户，所以地图页暂无统计信息

![空地图](assets/空地图.png)

若无任何发布过数据的设备，则地图初始中心设置在浙江大学玉泉校区

否则，设置在上传最多数据的设备的最近通信位置

地图显示页功能为：

* 显示上传数据量最多的前五个设备的历史轨迹，同时区分正常信息与告警信息

  ![轨迹](assets/轨迹.png)

  由于是随机生成的数据，所以路径比较复杂

  历史轨迹由设备最近十次发布数据的地点连接而成

  蓝色为正常信息，红色为告警信息

  鼠标移在标记点上，即可显示设备于对应位置发布的数据内容，即MQTT包payload部分的data字段

### 其他

#### 关于作者

在侧边栏中访问

显示作者信息

![关于作者](assets/关于作者.png)

#### 界面设置

于右上角工具栏中齿轮图标访问

![界面设置](assets/界面设置.png)

#### 注销

于右上角工具栏中第三个方块右下角下拉菜单中访问

推出后会清空当前token信息

![退出登录](assets/退出登录.png)

#### token过期

若token过期，则需要重新登录
